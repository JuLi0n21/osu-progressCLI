<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Website</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.15/dist/tailwind.min.css" rel="stylesheet">
    <title>osu!progress</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-image: url('background.jpg'); /* Replace 'background.jpg' with your background image URL */
            background-size: cover;
            background-position: center;
            font-family: Arial, sans-serif;
        }

        .content {
            max-width: 960px;
            min-width: 960px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .inner-content {
            margin: 20px 0;
        }

        p {
            font-size: 16px;
            line-height: 1.5;
        }

        @media (max-width: 949px) {

            .inner-content {
                margin: 10px 0;
            }

            h2 {
                font-size: 24px;
            }

            p {
                font-size: 14px;
                line-height: 1.3;
            }
        }

        /* Reset some default styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: rgba(28,23,25,255);
        }

        /* Header Styles */
        header {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 20px;
        }


        .backdrop--light {
            background-color: rgba(70,57,63,255);
        }

        .backdrop--medium {
            background-color: rgba(42,34,38,255);
        }
    </style>
</head>
<body>

    <div class="flex justify-center items-center">

        <div class="fixed bottom-0 w-full">
            <button id="loadDataButton" class="text-white rounded-full p-3 shadow-lg ml-4 mb-4 backdrop--medium">
                <img src="https://upload.wikimedia.org/wikipedia/commons/9/9a/Refresh_font_awesome.svg" alt="Refresh" style="width: 24px; height: 24px; filter: invert(100%);" />
            </button>
        </div>



        <div class="content w-1/2 rounded-lg backdrop--medium text-white">

            <div class="border-b rounded-lg backdrop--light mb-4">
                    
                <h1>Play History</h1>
                
                <div class="flex justify-evenly text-black">

                    <select id="filter">
                        <option value="" disabled selected>Select an Option</option>
                        <option value="option1">Option 1</option>
                        <option value="option2">Option 2</option>
                        <option value="option3">Option 3</option>
                        <option value="option4">Option 4</option>
                        <option value="option5">Option 5</option>
                        <option value="option6">Option 6</option>
                        <!-- Add more options as needed -->
                    </select>


                    <input type="text" id="from">
                    <label for="to">Select Date and Time:</label>
                    <input type="text" id="to">
                </div>

                <div style="height: 460px">
                    <canvas id="myChart"></canvas>
                </div>

            </div>

            <div class="flex backdrop--medium">
                <div class="w-1/2 p-4 rounded-l-lg backdrop--light">
                    <h2>BanchoTime</h2>
                    <canvas id="pieChart" width="450"></canvas>
                </div>
                <div class="w-1/2 rounded-r-lg backdrop--light">
                    <h2>TimeWasted</h2>
                    <canvas id="pieTimeWastedChart" width="450"></canvas>
                </div>
            </div>

        </div>

    </div>



    <script>

      
            flatpickr("#from", {
                enableTime: true,
            dateFormat: "Y-m-d H:i",
        });

            flatpickr("#to", {
                enableTime: true,
            dateFormat: "Y-m-d H:i",
        });
 
            function renderChart(data) {
                const date = [];
                const BeatmapSetid = [];
                const Beatmapid = [];
                const Osufilename = [];
                const Ar = [];
                const Cs = [];
                const Hp = [];
                const Od = [];
                const Status = [];
                const StarRating = [];
                const Bpm = [];
                const Artist = [];
                const Creator = [];
                const Username = [];
                const Accuracy = [];
                const MaxCombo = [];
                const Score = [];
                const Combo = [];
                const Hit50 = [];
                const Hit100 = [];
                const Hit300 = [];
                const Ur = [];
                const HitMiss = [];
                const Mode = [];
                const Mods = [];

                // Extract the relevant data from the JSON
                data.forEach(entry => {
                    console.log(entry);
                    date.push(entry[0].Date);
                    BeatmapSetid.push(entry[1].BeatmapSetid);
                    Beatmapid.push(entry[2].Beatmapid);
                    Osufilename.push(entry[3].Osufilename.slice(0, 5) + "...");
                    Ar.push(entry[4].Ar);
                    Cs.push(entry[5].Cs);
                    Hp.push(entry[6].Hp);
                    Od.push(entry[7].Od);
                    Status.push(entry[8].Status);
                    StarRating.push(parseFloat(entry[9].StarRating));
                    Bpm.push(entry[10].Bpm);
                    Artist.push(entry[11].Artist);
                    Creator.push(entry[12].Creator);
                    Username.push(entry[13].Username);
                    Accuracy.push(parseFloat(entry[14].Accuracy));
                    MaxCombo.push(entry[15].MaxCombo);
                    Score.push(entry[16].Score);
                    Combo.push(entry[17].Combo);
                    Hit50.push(entry[18].Hit50);
                    Hit100.push(entry[19].Hit100);
                    Hit300.push(entry[20].Hit300);
                    Ur.push(entry[21].Ur);
                    HitMiss.push(entry[22].HitMiss);
                    Mode.push(entry[23].Mode);
                    Mods.push(entry[24].Mods);
                });


                const ctx = document.getElementById('myChart').getContext('2d');

                const existingChart = Chart.getChart('myChart');
                if (existingChart) {
                    existingChart.destroy();
                }

                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Osufilename,
                        datasets: [
                            {
                                label: '50',
                                data: Hit50,
                                backgroundColor: 'rgba(220, 135, 39, 0.8)',
                                borderColor: 'rgba(0, 0, 0, 1)',
                                borderWidth: 1,
                                yAxisID: 'y',
                                order: 1,
                            },
                            {
                                label: '100',
                                data: Hit100,
                                backgroundColor: 'rgba(63, 220, 39, 0.8)',
                                borderColor: 'rgba(0, 0, 0, 1)',
                                borderWidth: 1,
                                yAxisID: 'y',
                                order: 1,
                            },
                            {
                                label: 'X',
                                data: HitMiss,
                                backgroundColor: 'rgba(204, 19, 19, 0.8)',
                                borderColor: 'rgba(0, 0, 0, 1)',
                                borderWidth: 1,
                                yAxisID: 'y',
                                order: 1,
                            },
                            {
                                label: 'Stars',
                                data: StarRating,
                                backgroundColor: 'rgba(204, 19, 19, 0.8)',
                                borderColor: 'rgba(0, 0, 0, 1)',
                                borderWidth: 1,
                                type: 'line',
                                yAxisID: 'y2',
                                order: 0,
                            },
                            {
                                label: 'Bpm',
                                data: Bpm,
                                backgroundColor: 'rgba(204, 19, 19, 0.8)',
                                borderColor: 'rgba(0, 0, 0, 1)',
                                borderWidth: 1,
                                type: 'line',
                                yAxisID: 'y3',
                                order: 0,
                            },
                        ]
                    },
                    options: {
                        plugins: {
                            title: {
                                display: true,
                                text: 'ScoreExample'
                            },
                            legend: {

                            }
                        },
                        responsive: true,
                        scales: {
                            x: {
                                stacked: true,
                            },
                            y: {
                                stacked: true
                            },
                            y2: {
                                position: 'right',

                                ticks: {
                                    color: 'rgba(204, 19, 19, 0.8)'
                                },
                                grid: {
                                    drawOnChartArea: false // only want the grid lines for one axis to show up
                                }
                            },
                            y3: {
                                position: 'right',

                                ticks: {
                                    color: 'rgba(243, 19, 19, 0.8)'
                                },
                                grid: {
                                    drawOnChartArea: false // only want the grid lines for one axis to show up
                                }
                            },
                        }
                    }
                });
            }

            function renderPie(data) {
                // Extract labels and values from the fetched data
                const labels = [];
                const values = [];

                for (let i = 0; i < data.length; i++) {
                    const item = data[i];
                    if (item.Key !== "" && item.Value >= 10000) {
                        labels.push(item.Key);
                        item.Value = item.Value / 3600000;
                        values.push(item.Value);
                    }
                }

                // Create an array of random colors for each segment
                const colors = values.map(() => '#' + (Math.random() * 0xFFFFFF << 0).toString(16));

                console.log(labels, values)
                // Data for the pie chart
                const pieData = {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                    }]
                };

                // Options for the pie chart
                const options = {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true, // Set to true to display the legend
                            position: 'right', // Position of the legend (you can adjust it as needed)
                        },
                    },

                };

                // Get the canvas element
                const pie = document.getElementById('pieChart').getContext('2d');


                const existingChart = Chart.getChart('pieChart');
                if (existingChart) {
                    existingChart.destroy();
                }

                const myChart = new Chart(pie, {
                    type: 'pie',
                    data: pieData,
                    options: options
                });
            }

            function renderTimewastedPie(data) {
                // Extract labels and values from the fetched data
                const labels = [];
                const values = [];
                const colors = [];

                for (let i = 0; i < data.length; i++) {
                    const item = data[i];
                    if (item.Key !== "" && item.Value >= 10000) {
                        labels.push(item.Key);
                        item.Value = item.Value / 3600000;
                        values.push(item.Value);
                        colors.push('#' + (Math.random() * 0xFFFFFF << 0).toString(16));
                    }
                }

                // Create an array of random colors for each segment

                console.log(labels, values)
                // Data for the pie chart
                const pieData = {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                    }]
                };

                // Options for the pie chart
                const options = {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true, // Set to true to display the legend
                            position: 'right', // Position of the legend (you can adjust it as needed)
                        },
                    },
                };

                // Get the canvas element
                const pie = document.getElementById('pieTimeWastedChart').getContext('2d');

                const existingChart = Chart.getChart('pieTimeWastedChart');
                if (existingChart) {
                    existingChart.destroy();
                }

                const myChart = new Chart(pie, {
                    type: 'pie',
                    data: pieData,
                    options: options
                });
            }

            document.getElementById('loadDataButton').addEventListener('click', function () {
                fetch('/api/beatmaps')
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        renderChart(data);
                    })
                    .catch(error => {
                        console.error('Error loading data:', error);
                    });

                fetch('/api/banchotime')
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        renderPie(data);
                    })
                    .catch(error => {
                        console.error('Error loading data:', error);
                    });

                fetch('/api/timewasted')
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        renderTimewastedPie(data);
                    })
                    .catch(error => {
                        console.error('Error loading data:', error);
                    });
            });

            // Trigger the initial data load when the page loads (optional)
            window.addEventListener('DOMContentLoaded', function () {
                // You can choose to load data immediately or wait for the button click
                // For example, you can uncomment the line below to load data on page load:
                // document.getElementById('loadDataButton').click();

            });


        </script>

</body>
</html>
